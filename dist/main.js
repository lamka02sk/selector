class h{set(e,t){this.data[e]=t}constructor(e){this.data={selector:null,callback:null,onOpen:null,onClose:null,onSelect:null,destroy:null,element:null,created:null,opened:null,closed:null,selected:null,beforeCreate:null,beforeDestroy:null,destroyed:null,beforeSelect:null,label:null,type:null,disabled:!1,identifier:null,cover:!1,relative:!1},Object.keys(e).forEach(t=>{this.data[t]=e[t]})}}class p{constructor(e,t){this.Settings=e,this.Instance=t}static closeSelector(){document.addEventListener("click",e=>{document.querySelectorAll(".selector-element").forEach(s=>{e.target!==s&&!s.contains(e.target)&&s.querySelectorAll(".selector-options, .selector-selected").forEach(i=>i.classList.remove("visible"))})})}showOptions(e,t){const s=this.Settings.data,i=this.Instance.isFilterType();t.querySelector(".selector-selected").addEventListener("click",o=>{if(!(t.matches("[data-disabled]")||this.Instance.render.hasAttribute("data-disabled"))){if(e.classList.toggle("visible"),o.currentTarget.classList.toggle("visible"),i){const r=t.querySelector("input");r.focus(),r.value="",r.oninput()}e.classList.contains("visible")?s.closed?s.closed():s.onClose&&s.onClose():s.opened?s.opened():s.onOpen&&s.onOpen()}})}clearFilter(e,t){e.addEventListener("click",()=>{t.value="",t.oninput()})}filterOptions(e,t){let s=e.querySelector("input"),i=t.querySelector(".selector-options");this.clearFilter(e.querySelector("span"),s),this.createIndex(i),s.oninput=()=>{const o=s.value.trim().toLowerCase();let r=i.querySelectorAll(".selector-option");JSON.parse(i.dataset.index).forEach((n,a)=>{~n[0].indexOf(o)||~n[1].indexOf(o)?r[a].classList.add("show"):r[a].classList.remove("show")})},s.onkeypress=o=>{if(o.keyCode&&o.keyCode===13){o.preventDefault();let r=t.querySelectorAll(".selector-option.show");if(r.length!==1)return;r[0].click()}}}createIndex(e){let t=Array.from(e.querySelectorAll(".selector-option")).map(s=>[s.children[0].innerText.toLowerCase(),s.dataset.item.toLowerCase()]);e.dataset.index=JSON.stringify(t)}select(e){let t=e.querySelector(".selector-selected");const s=this.Settings.data;let i=document.querySelector('select[name="'+e.dataset.reference+'"]');e.querySelector(".selector-options").addEventListener("click",o=>{let r=o.target;const n=".selector-option";if(r.matches(n)||r.parentNode.matches(n)){if(r.matches(n)||(r=r.parentNode),r.dataset.disabled||r.dataset.selected||r.parentNode.matches("[data-disabled]"))return;let a=e.querySelector("[data-selected]"),d=r.dataset.item;s.beforeSelect&&s.beforeSelect(e,d),delete a.dataset.selected,r.dataset.selected="",t.dataset.item=d,t.children[0].innerText=r.children[0].innerText,t.click(),i.querySelector("[selected]").removeAttribute("selected"),i.querySelector('[value="'+r.dataset.item+'"]').setAttribute("selected","true"),s.selected?s.selected(e,r.dataset.item):s.onSelect&&s.onSelect(e,r)}})}}class u{constructor(e,t,s){this.Settings=t.data,this.Events=new p(t,s),this.Instance=s,this._element=e,this.hideOrigin(),this._render=null}hideOrigin(){this._element.style.display="none"}renderParent(){let e=this.Instance.parentTemplate.cloneNode(!0);const t=this.Settings;e.id=this._element.id,e.dataset.reference=this._element.name,e.dataset.type=t.type||this._element.dataset.type||"default",this._element.disabled&&(e.dataset.disabled=!0),t.identifier&&(e.dataset.identifier=t.identifier,this._element.setAttribute("data-identifier",t.identifier)),t.relative&&e.classList.add("relative"),this._render=e}renderContent(){let e,t=this._render.querySelector(".selector-options");if(this.Settings.cover&&t.classList.add("cover"),this.Events.showOptions(t,this._render),this.Instance.isFilterType()){const s=this.renderSearch();t.appendChild(s),this.Events.filterOptions(s,this._render)}Array.from(this._element.children).forEach(s=>{const i=s.tagName;if(i==="OPTGROUP")e=this.renderGroup(s);else if(i==="OPTION")e=this.renderOption(s);else return;t.appendChild(e)}),this.Instance.isFilterType()&&this.Events.createIndex(t),this.Events.select(this._render)}renderSearch(){return this.Instance.filterTemplate||this.Instance.createFilterElement(),this.Instance.filterTemplate.cloneNode(!0)}renderGroup(e){let t=this.Instance.groupTemplate.cloneNode(!0);return t.dataset.group=t.children[0].innerText=e.label,e.disabled&&(t.dataset.disabled=!0),Array.from(e.children).forEach(s=>{t.appendChild(this.renderOption(s))}),t}renderOption(e){let t=this.Instance.optionTemplate.cloneNode(!0);return Object.keys(e.dataset).forEach(s=>{t.dataset[s]=e.dataset[s]}),t.dataset.item=e.value,t.children[0].innerText=e.innerText,e.disabled&&(t.dataset.disabled=!0),e.selected&&(t.dataset.selected=!0),t}renderSelected(){let e=this._render.querySelector(".selector-selected"),t=this._element.querySelector("[selected]");const s=this.Settings;t?(e.dataset.item=t.value,e.children[0].innerText=t.innerText):(e.dataset.item=null,e.children[0].innerText="---"),this._element.dataset.label?e.children[0].innerText=this._element.dataset.label:s.label&&(e.children[0].innerText=s.label)}show(){const e=this.Settings;return e.beforeCreate&&e.beforeCreate(),this._element.parentNode.insertBefore(this._render,this._element.nextSibling),e.created?e.created():e.callback&&e.callback(),this._render}}class f{constructor(e,t){this.parentTemplate=null,this.selectedTemplate=null,this.groupTemplate=null,this.optionsTemplate=null,this.optionTemplate=null,this.filterTemplate=null,this.Settings=t,this.element=e,this.createElements();let s=new u(e,t,this);s.renderParent(),s.renderContent(),s.renderSelected(),this.render=s.show()}isFilterType(){return this.Settings.type==="filter"||(this.element.getAttribute("data-type")||"").match(/(search)|(find)/)}createElement(e,t){let s=document.createElement(e);return Object.keys(t).forEach(i=>{s.setAttribute(i,t[i])}),s}createElements(){this.createParentElement(),this.createSelectedElement(),this.createGroupElement(),this.createOptionsElement(),this.createOptionElement(),this.parentTemplate.appendChild(this.selectedTemplate),this.parentTemplate.appendChild(this.optionsTemplate)}createParentElement(){this.parentTemplate=this.createElement("div",{class:"selector-element","data-reference":"","data-type":"",id:""})}createSelectedElement(){this.selectedTemplate=this.createElement("div",{class:"selector-selected"}),this.selectedTemplate.appendChild(this.createElement("p",{class:"selected-text"}))}createGroupElement(){this.groupTemplate=this.createElement("div",{class:"selector-group","data-group":""}),this.groupTemplate.appendChild(this.createElement("span",{class:"group-text"}))}createOptionsElement(){this.optionsTemplate=this.createElement("div",{class:"selector-options"})}createOptionElement(){this.optionTemplate=this.createElement("div",{class:"selector-option show","data-item":""}),this.optionTemplate.appendChild(this.createElement("span",{class:"option-text"}))}createFilterElement(){this.filterTemplate=this.createElement("div",{class:"selector-filter"}),this.filterTemplate.appendChild(this.createElement("input",{class:"selector-filter-input",type:"search","data-placeholder":"SELECTOR_FILTER_PLACEHOLDER",placeholder:"Filter options"})),this.filterTemplate.appendChild(this.createElement("span",{class:"selector-filter-clear"}))}enable(){this.element.disabled=!1,this.render.removeAttribute("data-disabled")}disable(){this.element.disabled=!0,this.render.dataset.disabled=""}}var c={instances:[],constructor(l){this.Settings=l,this.prepareElements(),this.render()},prepareElements(){let l=this.Settings.data.element;if(typeof l=="string")if(l=document.querySelectorAll(l),l.length)this.Settings.set("element",l);else throw new DOMException},render(){this.Settings.data.element.forEach(l=>{!this.checkElement(l)||this.instances.push(new f(l,this.Settings))}),this.Settings.data.disabled&&this.disable(),p.closeSelector()},checkElement(l){return l.nodeType?l.tagName==="SELECT":!1},enable(l){l||(this.Settings.data.disabled=!1),l?this.instances.forEach(e=>{e.element.outerHTML===l.outerHTML&&e.enable()}):this.instances.forEach(e=>e.enable())},disable(l){l||(this.Settings.data.disabled=!0),l?this.instances.forEach(e=>{e.element.outerHTML===l.outerHTML&&e.disable()}):this.instances.forEach(e=>e.disable())},destroy(){let l=this.Settings.data;l.beforeDestroy&&l.beforeDestroy(),l.element.forEach(e=>{let t=e.parentNode;t.removeChild(t.querySelector('[data-reference="'+e.name+'"]')),e.style.display=""}),l.destroyed&&l.destroyed()}};window.Selector=class{constructor(l){l=new h(l),c.constructor(l)}enable(l=null){c.enable(l)}disable(l=null){c.disable(l)}destroy(){c.destroy()}};
